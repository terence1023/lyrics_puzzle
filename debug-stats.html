<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»Ÿè®¡åŠŸèƒ½è°ƒè¯•</title>
    <style>
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            color: #667eea;
            margin-top: 0;
        }
        button {
            background: #6aaa64;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a9a54;
        }
        button.danger {
            background: #d32f2f;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        .stats-display {
            font-size: 32px;
            font-weight: bold;
            color: #6aaa64;
            text-align: center;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š ä»Šæ—¥é€šè¿‡äººæ•°ç»Ÿè®¡ - è°ƒè¯•å·¥å…·</h1>
    
    <div class="debug-panel">
        <h2>å½“å‰çŠ¶æ€</h2>
        <div class="stats-display" id="current-wins">åŠ è½½ä¸­...</div>
        <p style="text-align: center;">ä»Šæ—¥æ—¥æœŸ: <strong id="today-date"></strong></p>
    </div>
    
    <div class="debug-panel">
        <h2>æµ‹è¯•æ“ä½œ</h2>
        <button onclick="testRecordWin()">âœ… æ¨¡æ‹Ÿé€šå…³ï¼ˆrecordWinï¼‰</button>
        <button onclick="testUpdateDisplay()">ğŸ”„ åˆ·æ–°æ˜¾ç¤ºï¼ˆupdateDisplayï¼‰</button>
        <button onclick="clearTodayRecord()">ğŸ—‘ï¸ æ¸…é™¤ä»Šæ—¥è®°å½•</button>
        <button onclick="clearAll()" class="danger">âš ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
    </div>
    
    <div class="debug-panel">
        <h2>LocalStorage æ•°æ®</h2>
        <table id="storage-table">
            <thead>
                <tr>
                    <th>é”®</th>
                    <th>å€¼</th>
                </tr>
            </thead>
            <tbody id="storage-data">
            </tbody>
        </table>
        <button onclick="refreshStorageDisplay()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
    </div>
    
    <div class="debug-panel">
        <h2>å†å²ç»Ÿè®¡</h2>
        <div id="history-stats"></div>
    </div>
    
    <div class="debug-panel">
        <h2>æ§åˆ¶å°æ—¥å¿—</h2>
        <div id="console-log" class="log"></div>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <script>
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logDiv = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#0f0',
                error: '#f00',
                warn: '#ff0',
                success: '#0ff'
            };
            const entry = document.createElement('div');
            entry.style.color = colors[type] || '#0f0';
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.insertBefore(entry, logDiv.firstChild);
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('console-log').innerHTML = '';
        }
        
        // è·å–ä»Šæ—¥æ—¥æœŸ
        function getTodayKey() {
            const today = new Date();
            return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
        }
        
        // è·å–ç»Ÿè®¡æ•°æ®
        function getStats() {
            try {
                const stats = localStorage.getItem('dailyStats');
                return stats ? JSON.parse(stats) : {};
            } catch (e) {
                log('âŒ è¯»å–ç»Ÿè®¡æ•°æ®å¤±è´¥: ' + e.message, 'error');
                return {};
            }
        }
        
        // ä¿å­˜ç»Ÿè®¡æ•°æ®
        function saveStats(stats) {
            try {
                localStorage.setItem('dailyStats', JSON.stringify(stats));
                log('ğŸ’¾ ç»Ÿè®¡æ•°æ®å·²ä¿å­˜', 'success');
            } catch (e) {
                log('âŒ ä¿å­˜ç»Ÿè®¡æ•°æ®å¤±è´¥: ' + e.message, 'error');
            }
        }
        
        // è·å–ä»Šæ—¥é€šè¿‡äººæ•°
        function getTodayWins() {
            const stats = getStats();
            const today = getTodayKey();
            return stats[today] || 0;
        }
        
        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const wins = getTodayWins();
            const today = getTodayKey();
            document.getElementById('current-wins').textContent = wins;
            document.getElementById('today-date').textContent = today;
            log(`ğŸ“ˆ å½“å‰æ˜¾ç¤º: ${wins} äººé€šè¿‡`, 'info');
        }
        
        // æµ‹è¯• recordWin
        function testRecordWin() {
            const stats = getStats();
            const today = getTodayKey();
            const winRecordKey = `win_${today}`;
            const hasRecorded = localStorage.getItem(winRecordKey);
            
            log(`ğŸ® æµ‹è¯• recordWin - æ—¥æœŸ: ${today}`, 'info');
            log(`   å·²è®°å½•æ ‡è®°: ${hasRecorded}`, 'info');
            
            if (!hasRecorded) {
                stats[today] = (stats[today] || 0) + 1;
                saveStats(stats);
                localStorage.setItem(winRecordKey, 'true');
                log(`âœ… è®°å½•æˆåŠŸï¼ä»Šæ—¥é€šè¿‡äººæ•°: ${stats[today]}`, 'success');
                updateDisplay();
                refreshStorageDisplay();
                showHistory();
            } else {
                log('â„¹ï¸ ä»Šæ—¥å·²è®°å½•è¿‡é€šå…³ï¼Œè·³è¿‡', 'warn');
            }
        }
        
        // æµ‹è¯• updateDisplay
        function testUpdateDisplay() {
            log('ğŸ”„ æµ‹è¯• updateDisplay', 'info');
            updateDisplay();
        }
        
        // æ¸…é™¤ä»Šæ—¥è®°å½•
        function clearTodayRecord() {
            const today = getTodayKey();
            const winRecordKey = `win_${today}`;
            localStorage.removeItem(winRecordKey);
            log(`ğŸ—‘ï¸ å·²æ¸…é™¤ä»Šæ—¥è®°å½•æ ‡è®°: ${winRecordKey}`, 'warn');
            refreshStorageDisplay();
        }
        
        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAll() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç»Ÿè®¡æ•°æ®å—ï¼Ÿ')) {
                localStorage.removeItem('dailyStats');
                for (let key in localStorage) {
                    if (key.startsWith('win_')) {
                        localStorage.removeItem(key);
                    }
                }
                log('ğŸ—‘ï¸ æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'warn');
                updateDisplay();
                refreshStorageDisplay();
                showHistory();
            }
        }
        
        // åˆ·æ–° LocalStorage æ˜¾ç¤º
        function refreshStorageDisplay() {
            const tbody = document.getElementById('storage-data');
            tbody.innerHTML = '';
            
            const relevantKeys = [];
            for (let key in localStorage) {
                if (key === 'dailyStats' || key.startsWith('win_')) {
                    relevantKeys.push(key);
                }
            }
            
            if (relevantKeys.length === 0) {
                tbody.innerHTML = '<tr><td colspan="2" style="text-align:center; color:#999;">æš‚æ— æ•°æ®</td></tr>';
            } else {
                relevantKeys.sort().forEach(key => {
                    const tr = document.createElement('tr');
                    const tdKey = document.createElement('td');
                    const tdValue = document.createElement('td');
                    tdKey.textContent = key;
                    tdValue.textContent = localStorage.getItem(key);
                    tdValue.style.fontFamily = 'monospace';
                    tdValue.style.fontSize = '12px';
                    tr.appendChild(tdKey);
                    tr.appendChild(tdValue);
                    tbody.appendChild(tr);
                });
            }
            log('ğŸ”„ LocalStorage æ•°æ®å·²åˆ·æ–°', 'info');
        }
        
        // æ˜¾ç¤ºå†å²ç»Ÿè®¡
        function showHistory() {
            const stats = getStats();
            const historyDiv = document.getElementById('history-stats');
            
            if (Object.keys(stats).length === 0) {
                historyDiv.innerHTML = '<p style="color:#999;">æš‚æ— å†å²æ•°æ®</p>';
            } else {
                let html = '<table style="width:100%;"><tr><th>æ—¥æœŸ</th><th>é€šè¿‡äººæ•°</th></tr>';
                const sortedDates = Object.keys(stats).sort().reverse();
                sortedDates.forEach(date => {
                    html += `<tr><td>${date}</td><td><strong>${stats[date]}</strong> äºº</td></tr>`;
                });
                html += '</table>';
                historyDiv.innerHTML = html;
            }
        }
        
        // åˆå§‹åŒ–
        window.onload = function() {
            log('âœ… è°ƒè¯•å·¥å…·åŠ è½½å®Œæˆ', 'success');
            updateDisplay();
            refreshStorageDisplay();
            showHistory();
        };
    </script>
</body>
</html>
