# 🌐 全局统计功能 - 完整设置指南

## 📋 问题说明

你希望"今日通过人数"对所有用户显示相同的数值，而不是每个浏览器独立统计。由于 GitHub Pages 是纯静态托管，需要第三方后端服务来存储全局数据。

## 🎯 推荐方案

### 方案一：Firebase Realtime Database（★★★★★ 推荐）

**优点：**
- ✅ 完全免费（每月 1GB 存储，100,000 次同时连接）
- ✅ 实时同步（所有用户立即看到更新）
- ✅ 简单易用，无需后端代码
- ✅ Google 官方服务，稳定可靠

**设置步骤：**

1. **创建 Firebase 项目**
   ```
   访问：https://console.firebase.google.com/
   点击"添加项目"
   输入项目名称：lyrics-puzzle
   ```

2. **启用 Realtime Database**
   ```
   在左侧菜单选择 "Realtime Database"
   点击"创建数据库"
   选择地区：asia-southeast1（新加坡）
   安全规则选择"测试模式"（允许读写）
   ```

3. **获取配置信息**
   ```
   点击项目设置 > 常规
   滚动到"您的应用"部分
   选择"Web应用"（</> 图标）
   复制 firebaseConfig 对象
   ```

4. **更新代码**
   - 打开 `index-firebase.html`
   - 替换 `firebaseConfig` 中的配置信息
   - 将 `index-firebase.html` 重命名为 `index.html`

5. **部署**
   ```bash
   git add .
   git commit -m "启用Firebase全局统计"
   git push origin main
   ```

---

### 方案二：Supabase（★★★★☆）

**优点：**
- ✅ 开源，基于 PostgreSQL
- ✅ 免费额度充足
- ✅ 提供实时订阅功能

**设置步骤：**

1. 访问 https://supabase.com/
2. 注册并创建项目
3. 创建表 `daily_stats`
4. 使用 JavaScript 客户端库

---

### 方案三：GitHub Gist（★★★☆☆）

**优点：**
- ✅ 完全免费
- ✅ 无需额外注册

**缺点：**
- ❌ 需要 Personal Access Token
- ❌ 有速率限制（每小时 5000 次请求）
- ❌ 不是实时的

**设置步骤：**

1. **创建 Personal Access Token**
   ```
   访问：https://github.com/settings/tokens
   点击 "Generate new token (classic)"
   勾选 "gist" 权限
   复制 token（只显示一次！）
   ```

2. **创建公开 Gist**
   ```
   访问：https://gist.github.com/
   文件名：lyrics-puzzle-stats.json
   内容：
   {
     "dailyStats": {},
     "lastUpdate": ""
   }
   创建为 Public Gist
   复制 URL 中的 Gist ID
   ```

3. **更新代码**
   打开 `cloud-stats.js`，配置：
   ```javascript
   GIST_ID: '你的Gist ID',
   GITHUB_TOKEN: '你的Token',
   USE_CLOUD: true
   ```

---

### 方案四：简易模拟方案（★★☆☆☆）

如果不想配置后端，可以使用**模拟全局统计**：

**原理：** 基于日期生成确定性的"虚拟"统计数字，所有用户看到相同但是假的数据。

**实现：**

```javascript
// 添加到 script.js
const SimulatedStats = {
    getTodayKey() {
        const today = new Date();
        return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
    },
    
    // 基于日期生成确定性的"通过人数"
    getTodayWins() {
        const today = this.getTodayKey();
        // 使用日期字符串生成种子
        let seed = 0;
        for (let i = 0; i < today.length; i++) {
            seed = seed * 31 + today.charCodeAt(i);
        }
        
        // 生成 10-50 之间的随机数
        const baseNumber = 10 + (seed % 40);
        
        // 加上当前小时数（模拟递增）
        const hour = new Date().getHours();
        const increment = Math.floor(hour / 2);
        
        return baseNumber + increment;
    },
    
    updateDisplay() {
        const wins = this.getTodayWins();
        document.getElementById('daily-wins').textContent = wins;
    },
    
    init() {
        this.updateDisplay();
        // 每10分钟更新一次
        setInterval(() => this.updateDisplay(), 10 * 60 * 1000);
    }
};

// 使用
SimulatedStats.init();
```

---

## 🚀 快速开始（Firebase）

### 1. 最小化配置

创建文件 `firebase-config.js`:

```javascript
export const firebaseConfig = {
    apiKey: "你的API密钥",
    authDomain: "你的项目.firebaseapp.com",
    databaseURL: "https://你的项目.firebaseio.com",
    projectId: "你的项目ID",
    storageBucket: "你的项目.appspot.com",
    messagingSenderId: "你的发送者ID",
    appId: "你的应用ID"
};
```

### 2. 安全规则设置

在 Firebase Console > Realtime Database > 规则：

```json
{
  "rules": {
    "dailyStats": {
      ".read": true,
      ".write": true,
      "$date": {
        ".validate": "newData.isNumber()"
      }
    }
  }
}
```

### 3. 测试

```bash
# 本地测试
open index-firebase.html

# 部署
git add .
git commit -m "添加Firebase全局统计"
git push origin main
```

---

## 📊 数据结构

### Firebase Realtime Database

```
lyrics-puzzle-db/
  └── dailyStats/
      ├── 2025-10-16: 23
      ├── 2025-10-17: 45
      └── 2025-10-18: 12
```

---

## 🔒 安全注意事项

### Firebase API密钥

- ✅ API密钥可以公开（仅用于连接）
- ✅ 通过安全规则控制访问权限
- ❌ 不要暴露数据库写入权限

### 防止滥用

在 Firebase 规则中添加限制：

```json
{
  "rules": {
    "dailyStats": {
      ".read": true,
      "$date": {
        ".write": "!data.exists() || newData.val() <= data.val() + 1"
      }
    }
  }
}
```

---

## 💡 最佳实践

1. **使用 Firebase**（推荐）
   - 简单、可靠、免费
   - 实时同步

2. **添加本地缓存**
   - 减少 API 调用
   - 提升加载速度

3. **防止重复提交**
   - 本地标记已记录
   - 服务端验证

---

## 📞 需要帮助？

### 选项 A：我来帮你配置 Firebase

告诉我你是否愿意创建 Firebase 项目，我会提供详细的逐步指导。

### 选项 B：使用模拟统计

如果不想配置后端，我可以实现一个更精美的模拟统计系统。

### 选项 C：使用 Gist

我可以帮你设置 GitHub Gist 方案（需要你提供 token）。

---

**推荐：** 使用 Firebase，5分钟即可完成配置！🚀
